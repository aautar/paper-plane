{"version":3,"file":"paper-plane.min.js","sources":["../src/PaperPlane.js","../src/PaperPlane.window.js"],"sourcesContent":["const PaperPlane = {};\r\n\r\nPaperPlane.ContentType = {\r\n    APPLICATION_JSON: \"application/json\"\r\n};\r\n\r\nPaperPlane.convertBlobToString = function(_blob, _onConvert) {\r\n    const reader = new FileReader();\r\n    reader.readAsText(_blob); \r\n    reader.onloadend = function() {\r\n        _onConvert(reader.result);\r\n    };\r\n};\r\n\r\n/**\r\n * \r\n * @param {Blob} _respBlob \r\n * @returns {String|Object|Blob}\r\n */\r\nPaperPlane.parseXHRResponseData = function(_respBlob, _onParseComplete) {\r\n    if(typeof _respBlob === 'undefined' || _respBlob === null || _respBlob.size === 0) {\r\n        _onParseComplete(_respBlob);\r\n        return;\r\n    }\r\n\r\n    if(_respBlob.type === PaperPlane.ContentType.APPLICATION_JSON) {\r\n        var parsedResponseBody = {};\r\n        \r\n        PaperPlane.convertBlobToString(_respBlob, function(_blobTextual) {\r\n            parsedResponseBody = JSON.parse(_blobTextual);\r\n            _onParseComplete(parsedResponseBody);\r\n        });\r\n\r\n    } else if(_respBlob.type.split('/')[0] === 'text') {\r\n        PaperPlane.convertBlobToString(_respBlob, function(_blobTextual) {\r\n            _onParseComplete(_blobTextual);\r\n        });\r\n    } else {\r\n        _onParseComplete(_respBlob);\r\n    }\r\n};\r\n\r\n/**\r\n * @param {FormData} _data\r\n * @param {Map=} _httpHeaders\r\n * @returns {Object}\r\n */\r\nPaperPlane.makeFormDataRequestData = function(_data, _httpHeaders) {\r\n    return {\r\n        body: _data,\r\n        headers: (_httpHeaders || new Map())\r\n    };\r\n};\r\n\r\n/**\r\n * @param {Object} _data\r\n * @param {Map=} _httpHeaders\r\n * @returns {Object}\r\n */\r\nPaperPlane.makeJsonRequestData = function(_data, _httpHeaders) {\r\n    _httpHeaders = _httpHeaders || (new Map());\r\n    _httpHeaders.set(\"Content-Type\", PaperPlane.ContentType.APPLICATION_JSON);\r\n\r\n    return {\r\n        body: JSON.stringify(_data),\r\n        headers: _httpHeaders\r\n    };\r\n};\r\n\r\n/**\r\n * @param {Blob} _blob\r\n * @param {Map=} _httpHeaders\r\n * @returns {Object}\r\n */\r\nPaperPlane.makeBlobRequestData = function(_blob, _httpHeaders) {\r\n    _httpHeaders = _httpHeaders || (new Map());\r\n    _httpHeaders.set(\"Content-Type\", _blob.type);\r\n\r\n    return {\r\n        body: _blob,\r\n        headers: _httpHeaders\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * @callback PaperPlane~responseCallback\r\n * @param {String|Object} responseData\r\n * @param {XMLHttpRequest} xhr\r\n */\r\n\r\n\r\n/**\r\n * \r\n * @param {String} _method\r\n * @param {String} _url\r\n * @param {Object} _requestData\r\n * @param {PaperPlane~responseCallback} [_onSuccess]\r\n * @param {PaperPlane~responseCallback} [_onError]\r\n * @param {PaperPlane~responseCallback} [_onComplete]\r\n * @returns {XMLHttpRequest}\r\n */\r\nPaperPlane.xhr = function(\r\n    _method, \r\n    _url,\r\n    _requestData,\r\n    _onSuccess,\r\n    _onError,\r\n    _onComplete,\r\n    _clientSettings\r\n) {\r\n    const httpHeaders = _requestData.headers;\r\n    _onSuccess = _onSuccess || (() => {});\r\n    _onError = _onError || (() => {});        \r\n    _onComplete = _onComplete || (() => {});    \r\n\r\n    const internalErrorHander = function(_xhr, _errorMessageHint) {\r\n        if(_errorMessageHint) {\r\n            _onError(_errorMessageHint, xhr);\r\n        } else {\r\n            PaperPlane.parseXHRResponseData(xhr.response, function(_parsedResponse) {\r\n                _onError(_parsedResponse, xhr);\r\n            });\r\n        }\r\n    };\r\n\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open(_method, _url);\r\n\r\n    for (let [key,value] of httpHeaders) {\r\n        xhr.setRequestHeader(key, value);\r\n    }\r\n\r\n    xhr.responseType = 'blob';\r\n\r\n    if(_clientSettings && _clientSettings.timeout) {\r\n        xhr.timeout = _clientSettings.timeout;\r\n    } else {\r\n        xhr.timeout = 30000;\r\n    }\r\n\r\n    xhr.onload = function() {\r\n        if(xhr.status >= 400) {\r\n            internalErrorHander(xhr);\r\n        } else {\r\n            PaperPlane.parseXHRResponseData(xhr.response, function(_parsedResponse) {\r\n                _onSuccess(_parsedResponse, xhr);\r\n            });\r\n        }\r\n    };\r\n\r\n    xhr.ontimeout = function() {\r\n        internalErrorHander(xhr, \"client timeout\");\r\n    };\r\n\r\n    xhr.onerror = function() {\r\n        internalErrorHander(xhr);\r\n    };\r\n\r\n    xhr.onloadend = function() {\r\n        PaperPlane.parseXHRResponseData(xhr.response, function(_parsedResponse) {\r\n            _onComplete(_parsedResponse, xhr);\r\n        });\r\n    };\r\n\r\n    xhr.send(_requestData.body);\r\n\r\n    return xhr;\r\n};\r\n\r\n/**\r\n * \r\n * @param {String} _url\r\n * @param {Object} _requestData\r\n * @param {PaperPlane~responseCallback} _onSuccess\r\n * @param {PaperPlane~responseCallback} _onError\r\n * @param {PaperPlane~responseCallback} _onComplete\r\n * @returns {XMLHttpRequest}\r\n */\r\nPaperPlane.post = function(\r\n    _url, \r\n    _requestData,\r\n    _onSuccess, \r\n    _onError, \r\n    _onComplete\r\n) {\r\n    return PaperPlane.xhr(\r\n        \"POST\",\r\n        _url,\r\n        _requestData,\r\n        _onSuccess,\r\n        _onError,\r\n        _onComplete\r\n    );\r\n};\r\n\r\n\r\n/**\r\n * \r\n * @param {String} _url\r\n * @param {Object} _requestData\r\n * @param {PaperPlane~responseCallback} _onSuccess\r\n * @param {PaperPlane~responseCallback} _onError\r\n * @param {PaperPlane~responseCallback} _onComplete\r\n * @returns {XMLHttpRequest}\r\n */\r\nPaperPlane.put = function(\r\n    _url, \r\n    _requestData,\r\n    _onSuccess, \r\n    _onError, \r\n    _onComplete\r\n) {\r\n    return PaperPlane.xhr(\r\n        \"PUT\",\r\n        _url,\r\n        _requestData,\r\n        _onSuccess,\r\n        _onError,\r\n        _onComplete\r\n    );\r\n\r\n};\r\n\r\n\r\n/**\r\n * \r\n * @param {String} _url\r\n * @param {Object} _requestData\r\n * @param {PaperPlane~responseCallback} _onSuccess\r\n * @param {PaperPlane~responseCallback} _onError\r\n * @param {PaperPlane~responseCallback} _onComplete\r\n * @returns {XMLHttpRequest}\r\n */\r\nPaperPlane.delete = function(\r\n    _url, \r\n    _requestData,\r\n    _onSuccess, \r\n    _onError, \r\n    _onComplete\r\n) {\r\n    return PaperPlane.xhr(\r\n        \"DELETE\",\r\n        _url,\r\n        _requestData,\r\n        _onSuccess,\r\n        _onError,\r\n        _onComplete\r\n    );\r\n};\r\n\r\n/**\r\n * @param {String} _url \r\n * @param {Object} [_httpHeaders={}]\r\n * @param {PaperPlane~responseCallback} _onSuccess\r\n * @param {PaperPlane~responseCallback} _onError\r\n * @param {PaperPlane~responseCallback} _onComplete\r\n * @returns {XMLHttpRequest}\r\n */\r\nPaperPlane.get = function(\r\n    _url, \r\n    _httpHeaders,\r\n    _onSuccess, \r\n    _onError, \r\n    _onComplete\r\n) {\r\n    return PaperPlane.xhr(\r\n        \"GET\",\r\n        _url,\r\n        {\r\n            body: null,\r\n            headers: _httpHeaders\r\n        },\r\n        _onSuccess,\r\n        _onError,\r\n        _onComplete\r\n    ); \r\n};\r\n\r\n/**\r\n * @param {String} _url \r\n * @param {Object} [_httpHeaders={}]\r\n * @param {PaperPlane~responseCallback} _onSuccess\r\n * @param {PaperPlane~responseCallback} _onError\r\n * @param {PaperPlane~responseCallback} _onComplete\r\n * @returns {XMLHttpRequest}\r\n */\r\nPaperPlane.head = function(\r\n    _url, \r\n    _httpHeaders,\r\n    _onSuccess, \r\n    _onError, \r\n    _onComplete\r\n) {\r\n    return PaperPlane.xhr(\r\n        \"HEAD\",\r\n        _url,\r\n        {\r\n            body: null,\r\n            headers: _httpHeaders\r\n        },\r\n        _onSuccess,\r\n        _onError,\r\n        _onComplete\r\n    ); \r\n};\r\n\r\n\r\n/**\r\n * \r\n * @param {String} _url\r\n * @param {Object} _requestData\r\n * @returns {Boolean}\r\n */\r\nPaperPlane.postBeacon = function(_url, _requestData) {\r\n    return navigator.sendBeacon(_url, _requestData.body);\r\n};\r\n\r\nexport { PaperPlane };\r\n","import {PaperPlane} from './PaperPlane'\r\n\r\nwindow.PaperPlane = PaperPlane;\r\n"],"names":["PaperPlane","ContentType","APPLICATION_JSON","convertBlobToString","_blob","_onConvert","reader","FileReader","readAsText","onloadend","result","parseXHRResponseData","_respBlob","_onParseComplete","size","type","parsedResponseBody","_blobTextual","JSON","parse","split","makeFormDataRequestData","_data","_httpHeaders","body","headers","Map","makeJsonRequestData","set","stringify","makeBlobRequestData","xhr","_method","_url","_requestData","_onSuccess","_onError","_onComplete","_clientSettings","httpHeaders","internalErrorHander","_xhr","_errorMessageHint","response","_parsedResponse","XMLHttpRequest","open","key","value","setRequestHeader","responseType","timeout","onload","status","ontimeout","onerror","send","post","put","delete","get","head","postBeacon","navigator","sendBeacon","window"],"mappings":"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"}